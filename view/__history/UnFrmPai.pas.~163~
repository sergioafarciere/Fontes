unit UnFrmPai;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ExtCtrls, StdCtrls, Buttons, UnModelAgente, UnConexaoSql, DB, UnModelEscola,
  Mask, UnControllerEscola;

type
  TOperacao = (opIncluir, opAlterar, opNavegar, opExcluir, opGravar, opCancelar, opSair);
  TfrmPai = class(TForm)
    pnlTopPai: TPanel;
    btnNovo: TBitBtn;
    btnAlterar: TBitBtn;
    btnExcluir: TBitBtn;
    btnCancelar: TBitBtn;
    pnlBottonPai: TPanel;
    tmnPai: TTimer;
    lblCodigo: TLabel;
    edtCodigo: TEdit;
    lblNome: TLabel;
    edtNome: TEdit;
    btnSair: TBitBtn;
    btnGravar: TBitBtn;
    lblTipoPessoa: TLabel;
    cbxTipoPessoa: TComboBox;
    lblCPFCNPJ: TLabel;
    mskCPFCNPJ: TMaskEdit;
    mskDataCadastro: TMaskEdit;
    lblCep: TLabel;
    mskCEP: TMaskEdit;
    lblUF: TLabel;
    cbxUF: TComboBox;
    lblEndereco: TLabel;
    edtEndereco: TEdit;
    lblNumero: TLabel;
    edtNumero: TEdit;
    lblBairro: TLabel;
    edtBairro: TEdit;
    lblCidade: TLabel;
    lblComplemento: TLabel;
    lblEmail: TLabel;
    edtCidade: TEdit;
    edtComplemento: TEdit;
    edtEmail: TEdit;
    Label1: TLabel;
    Label2: TLabel;
    edtContato: TEdit;
    Label3: TLabel;
    mmoObservacoes: TMemo;
    mskTelefone: TMaskEdit;
    procedure mascaraCPFCNPJ(Sender: TObject);
    procedure NavegarEnter(Sender: TObject; var Key: Char);
    procedure limparCampos;
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure FormShow(Sender: TObject);
  public
    FOperacao: TOperacao;
    procedure habilitarComandos(aOperacao : TOperacao);
  end;

var
  frmPai: TfrmPai;

implementation

{$R *.dfm}


{ TfrmPai }
{$region'CREATE_DESTROY'}
procedure TfrmPai.FormCreate(Sender: TObject);
begin
  dmConexao := TdmConexao.Create(nil);
end;
procedure TfrmPai.FormDestroy(Sender: TObject);
begin
  FreeAndNil(dmConexao);
end;

procedure TfrmPai.FormShow(Sender: TObject);
begin
  habilitarComandos(opNavegar);
end;
{$endregion}

{$region'CONTROLE DE TELA'}
procedure TfrmPai.habilitarComandos(aOperacao: TOperacao);
begin
  case aOperacao of
  opAlterar, opIncluir:
  begin
    edtCodigo.Enabled := False;
    cbxTipoPessoa.Enabled := True;
    edtNome.Enabled := True;
    mskCPFCNPJ.Enabled := True;
    mskCEP.Enabled := True;
    cbxUF.Enabled := True;
    edtEndereco.Enabled := True;
    edtNumero.Enabled := True;
    edtBairro.Enabled := True;
    edtCidade.Enabled := True;
    edtComplemento.Enabled := True;
    edtEmail.Enabled := True;
    edtContato.Enabled := True;
    mskDataCadastro.Visible := False;
    btnNovo.Enabled := False;;
    btnExcluir.Enabled := False;
    btnAlterar.Enabled := False;
    btnCancelar.Enabled := True;
    btnGravar.Enabled := True;
    btnSair.Enabled := False;
  end;
  opNavegar:
  begin
    edtCodigo.Enabled := True;
    edtNome.Enabled := False;
    btnNovo.Enabled := True;
    mskDataCadastro.Visible := False;
    btnExcluir.Enabled := True;
    btnAlterar.Enabled := True;
    btnCancelar.Enabled := False;
    btnGravar.Enabled := False;
    btnSair.Enabled := True;
  end;
  end;
end;

procedure TfrmPai.NavegarEnter(Sender: TObject; var Key: Char);
begin
  if Key = #13 then
  Perform(WM_NEXTDLGCTL,0,0);
end;

procedure TfrmPai.limparCampos;
var
  loop: Integer;
begin
  for loop := 0 to ComponentCount - 1 do
  begin
    if Components[loop] is (TCustomEdit) then
      TEdit(Components[loop] as TCustomEdit).Clear;
    if Components[loop] is (TComboBox) then
    begin
      (Components[loop] as TComboBox).ItemIndex := -1;
      (Components[loop] as TComboBox).Text := EmptyStr;
    end;
    if Components[loop] is (TCheckBox) then
      (Components[loop] as TCheckBox).Checked := False;
  end;
end;

procedure TfrmPai.mascaraCPFCNPJ(Sender: TObject);
begin
    if cbxTipoPessoa.ItemIndex = 0 then
    begin
      lblCPFCNPJ.Caption := 'CPF';
      mskCPFCNPJ.EditMask := '999.999.999-99;0;_';
      mskCPFCNPJ.Width := 85;
    end;
    if cbxTipoPessoa.ItemIndex = 1 then
    begin
      lblCPFCNPJ.Caption := 'CNPJ';
      mskCPFCNPJ.EditMask := '99.999.999/9999-99;0;_';
      mskCPFCNPJ.Width := 108
    end;
  end;

{$endregion}

end.
